<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether - Setting Up an Aether-Based Solution</title>
    <link  charset="utf-8"  media="screen"  type="text/css" href="/css/index.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/images/aux-icon.png"/>
  </head>


  <body role="document" class="support">
    <nav class="navbar" role="navigation">
  <a class="logo" href="/index.html">Aether</a>
  <ul class="nav navbar__nav">
    <li class="nav-item__about"><a href="/index.html">About Aether</a></li>
    <li class="nav-item__support"><a href="/support.html">Support</a></li>
    <li class="nav-item__contact"><a href="/contact.html">Contact</a></li>
    <li class="navbar-button"><a class="btn" href="/demo.html">Watch demos</a></li>
  </ul>
</nav>
    
    

    <div id="content" class="content">
      <div id="top"></div>
      
    <div class="documentation">
  <div class="dropdown doc-nav-mobile">
    <a id="dropdownMenu2" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
      
        
          
        
          
        
      
        
          
        
          Setting up an Aether-Based Solution
        
          
        
          
        
      
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
      <li><a href="/support.html">Welcome</a></li>
    
      <li class="doc-nav-title">Introduction to Aether</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Try It For Yourself</li>
        <ul class="active-section">
          
            <li class="">
              <a href="/documentation/try/index.html">Installing Aether Bootstrap</a>
            </li>
          
            <li class="active">
              <a href="/documentation/try/walkthrough-core.html">Setting up an Aether-Based Solution</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-connect.html">Adding Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-gather.html">Adding Gather</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Setup and Deployment Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Aether UI User Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
    </ul>
  </div>

  <div class="doc-nav">
    <a href="/support.html">Welcome</a>
    
      <a href="/documentation/introduction/index.html"><h3 class="doc-nav-title">Introduction to Aether</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <a href="/documentation/try/index.html"><h3 class="doc-nav-title">Try It For Yourself</h3></a>
        <ul class="active-section">
          
            <li class="">
              <a href="/documentation/try/index.html">Installing Aether Bootstrap</a>
            </li>
          
            <li class="active">
              <a href="/documentation/try/walkthrough-core.html">Setting up an Aether-Based Solution</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-connect.html">Adding Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-gather.html">Adding Gather</a>
            </li>
          
        </ul>
    
      <a href="/documentation/setup-deployment/index.html"><h3 class="doc-nav-title">Setup and Deployment Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
        </ul>
    
      <a href="/documentation/ui/index.html"><h3 class="doc-nav-title">Aether UI User Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
  </div>
  <div class="doc-content">

    <h1 id="a-simple-aether-based-solution">A Simple Aether-Based Solution</h1>

<p>We’re going to take raw JSON data that has been collected during a microcensus, and learn how to break that data into pieces that can then be sent to different destinations. In Aether we do this by creating a new <em>pipeline</em>.</p>

<p>A pipeline consists of a path that data takes through Aether, and the transformations that it goes through along the way. Within a pipeline, we define one or more <em>data contracts</em> that specify the format of the transformed data, along with rules that define how the input data is transformed to comply with those contracts.</p>

<p>These contracts are defined using <em>schemas</em>, and the transformed data is known as <em>entities</em>, for reasons that will, hopefully, soon become obvious.</p>

<p>In the <code class="highlighter-rouge">assets</code> folder of the <code class="highlighter-rouge">aether-bootstrap</code> repository contains some sample data, some schemas and a set of mappings. For the purposes of this walkthrough, we’re going to copy and paste the contents of these files into the Aether UI (for a more detailed overview of the UI, check out its <a href="/documentation/ui/">documentation</a>).</p>

<p>Open the <a href="http://ui.aether.local">UI</a> and log in if you haven’t already. We’re going to create a new pipeline, so hit the button that’s handily labelled <em>NEW PIPELINE</em>. Enter a name, and press <em>START PIPELINE</em>.</p>

<h2 id="defining-our-input">Defining Our Input</h2>

<p>The first thing you see is the input screen, where you can either paste some raw JSON data, or an AVRO schema that defines your input data. Open the <code class="highlighter-rouge">sample-data.json</code> file from the <code class="highlighter-rouge">assets</code> folder, copy the contents, and paste it into the text area. It should now look like this:</p>

<p><img src="/images/walkthrough-1.png" alt="Input data" /></p>

<p>At the bottom of the screen is a button labelled <em>DERIVE DATA FROM SCHEMA</em>. Click this, and Aether will generate an AVRO schema for you. The structure of the sample data is now shown in the sidebar.</p>

<h2 id="defining-our-output-contracts">Defining Our Output Contracts</h2>

<p>Now we’re going to add some <em>entity type definitions</em>. These are (more) schemas that constitute the <em>data contracts</em> we mentioned earlier. Click on <em>ENTITY TYPES</em>, open <code class="highlighter-rouge">all.json</code> in <code class="highlighter-rouge">assets/schemas</code> and copy and paste everything into the text area where it says <em>Enter your schemas</em>. Click <em>ADD TO PIPELINE</em>.</p>

<p><img src="/images/walkthrough-2.png" alt="Entity types" /></p>

<h2 id="defining-our-mappings">Defining Our Mappings</h2>

<p>The third and final step is to create the mapping rules that specify how the input data is transformed into entities. Normally you would probably add these mappings one by one using the interface provided by the UI, but for the purposes of this walkthrough we’re going to - you guessed it - copy and paste the mapping definition from the <code class="highlighter-rouge">assets</code> folder.</p>

<p>Open up <code class="highlighter-rouge">mapping.json</code> from <code class="highlighter-rouge">assets/mappings/</code> and copy the contents. In the UI, click on <em>MAPPING</em>, and then go to the tab labelled <em>JSON</em>. Paste everything into the text area and click on <em>APPLY MAPPING RULES TO PIPELINE</em>.</p>

<p><img src="/images/walkthrough-3.png" alt="Mappings" /></p>

<p>Fields in the <em>INPUT</em> and <em>ENTITY TYPES</em> sidebars are now highlighted to indicate mappings between them; if you click on the <em>Mapping rules</em> tab you can see the individual mapping rules.</p>

<p>You might also have noticed the green dot next to the <em>OUTPUT</em> section in the top right hand corner of the screen. This indicates that your pipeline is successfully creating entities, i.e. that the data is being transformed and broken up into pieces as defined by our schemas. Open the <em>OUTPUT</em> screen, and you’ll see the transformed data.</p>

<p>Now you can hit the <em>PUBLISH PIPELINE</em> button at the top right. Your pipeline is now live and ready to receive data. Let’s check this by sending it a raw JSON submission. We’re going to use <code class="highlighter-rouge">curl</code> to send a JSON file to the API endpoint that was automatically created when you published your pipeline – but first we need to locate that endpoint…</p>

<h2 id="submitting-data-with-the-api">Submitting Data with the API</h2>

<p>The following <code class="highlighter-rouge">curl</code> command will tell you all the mappings that have been created on your Aether instance. If you have been following these instructions, there should only be one.</p>

<p><code class="highlighter-rouge">curl http://admin-kernel:adminadmin@kernel.aether.local:8000/mappings/</code></p>

<p>(Note that we’re using basic auth here; obviously this is not how you would authenticate on a production instance)</p>

<p>The output of this command should be a JSON description of the mapping that you just created with the UI, looking something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "count":1,
  "next":null,
  "previous":null,
  "results":[
    {
      "id":"2e4d2216-aade-48ef-8bc3-12f4792df07a",
      "url":"http://kernel.aether.local:8000/mappings/2e4d2216-aade-48ef-8bc3-12f4792df07a/",
      "project_url":"http://kernel.aether.local:8000/projects/774e33c8-d82b-43f9-82e4-27bb513aff68/",
      "submissions_url":"http://kernel.aether.local:8000/submissions/?mapping=2e4d2216-aade-48ef-8bc3-12f4792df07a",
      "created":"2018-07-09T13:11:43.562140Z" 
      ...
    }
  ]
}
</code></pre></div></div>

<p>The important field for us is the <code class="highlighter-rouge">id</code> of the mapping; this needs to be included in any data that we submit. So let’s do that now: open <code class="highlighter-rouge">assets/submission.json</code> in your favourite editor, and copy and paste the mapping id into the second line where it says <code class="highlighter-rouge">&lt;mapping UUID goes here&gt;</code>. It should now look something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "mapping": "2e4d2216-aade-48ef-8bc3-12f4792df07a",
  "payload": {
    "_id": "fKPopgxGLyzTUIPelIYLLJhGOYVEa",
    "_version": "YUPRCpknNpjXoRIeFIbTaqcVYBd",
    "start": "2018-07-01 15:32:05",
    ...
  }
}
</code></pre></div></div>

<p>Now we can use curl to post this file to Aether:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Content-Type: application/json" --data @assets/submission.json http://admin-kernel:adminadmin@kernel.aether.local/submissions/
</code></pre></div></div>

<p>Aether is now going to take this submitted data and do entity extractions based on the mappings that we set in the UI. We can check the results of this process by accessing the entities endpoint:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://admin-kernel:adminadmin@kernel.aether.local:8000/entities/
</code></pre></div></div>

<p>You should get a sizeable chunk of JSON code that represents the entities that were extracted from the sample data that you just submitted. The first key in the JSON should be <code class="highlighter-rouge">count</code>, and the value should be <code class="highlighter-rouge">18</code> - 18 entities were extracted, as the microcensus data was broken down into <code class="highlighter-rouge">Surveys</code>, <code class="highlighter-rouge">Buildings</code>, <code class="highlighter-rouge">Households</code> and <code class="highlighter-rouge">People</code> (or actually, <code class="highlighter-rouge">Persons</code>).</p>

<p>(At this point you may be saying to yourself, “That’s all very nice, but I don’t actually <em>want</em> to break my data up into separate entities”. That’s fine too - Aether can also create a pass-through pipeline for you, whereby the data that comes in is just pased through to the output without any extraction taking place - take a look at the UI documentation to find out more about how to do this)</p>

<p>Congratulations! You have just completed the set-up of your first Aether-based solution.</p>

<h2 id="recap">Recap</h2>

<ul>
  <li>We learned about pipelines</li>
  <li>We learned about the constituent parts of a pipeline:
    <ul>
      <li>Input data</li>
      <li>Schemas</li>
      <li>Mappings</li>
    </ul>
  </li>
  <li>We set up an example pipeline with the Aether UI</li>
  <li>We submitted some data to an API endpoint and saw how the pipeline was used to extract entities</li>
</ul>

<p>The <a href="walkthrough-connect.html">next step</a> is to extend the data pipeline so that it flows all the way out to CKAN.</p>


  </div>

</div>




    <div class="footer">
  <div class="social-links">
    <div class="email"><a href="mailto:solutions@ehealthafrica.org" target="_blank">solutions@ehealthafrica.org</a></div>
    <div class="facebook"><a href="https://www.facebook.com/EHealthAfrica" target="_blank"></a></div>
    <div class="twitter"><a href="https://twitter.com/eHealth_africa" target="_blank"></a></div>
    <div class="instagram"><a href="https://www.instagram.com/ehealthafrica/" target="_blank"></a></div>
    <div class="linkedin"><a href="https://www.linkedin.com/company/ehealth-&-information-systems-nigeria/" target="_blank"></a></div>
    <div class="youtube"><a href="https://www.youtube.com/channel/UCcgM_HhTcg5M9Ji3Of6QmUg" target="_blank"></a></div>
  </div>
  <a class="footer__logo" href="http://ehealthafrica.org" target="_blank">eHealth Africa</a>
</div>
      
    </div>
    <a href="#top" class="top circle-button-up"><i class="angle-right"></i></a>





        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-2.1.4.min.js"></script>
    <script src="/js/navbar.js"></script>
    <script src="/js/dropdown.js"></script>
    <script src="/js/input.js"></script>

  </body>

</html>

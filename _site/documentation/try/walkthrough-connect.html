<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether - Try It - Aether Connect</title>
    <link  charset="utf-8"  media="screen"  type="text/css" href="/css/index.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/images/aux-icon.png"/>
  </head>


  <body role="document" class="support">
    <nav class="navbar" role="navigation">
  <a class="logo" href="/index.html">Aether</a>
  <ul class="nav navbar__nav">
    <li class="nav-item__about"><a href="/index.html">About Aether</a></li>
    <li class="nav-item__support"><a href="/support.html">Support</a></li>
    <li class="nav-item__contact"><a href="/contact.html">Contact</a></li>
    <li class="navbar-button"><a class="btn" href="/demo.html">Watch demos</a></li>
  </ul>
</nav>
    
    

    <div id="content" class="content">
      <div id="top"></div>
      
    <div class="documentation">
  <div class="dropdown doc-nav-mobile">
    <a id="dropdownMenu2" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
      
        
          
        
          
        
      
        
          
        
          
        
          Adding Aether Connect
        
          
        
      
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
      <li><a href="/support.html">Welcome</a></li>
    
      <li class="doc-nav-title">Introduction to Aether</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Try It For Yourself</li>
        <ul class="active-section">
          
            <li class="">
              <a href="/documentation/try/index.html">Installing Aether Bootstrap</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-core.html">Setting up an Aether-Based Solution</a>
            </li>
          
            <li class="active">
              <a href="/documentation/try/walkthrough-connect.html">Adding Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-gather.html">Adding Gather</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Setup and Deployment Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Aether UI User Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
    </ul>
  </div>

  <div class="doc-nav">
    <a href="/support.html">Welcome</a>
    
      <a href="/documentation/introduction/index.html"><h3 class="doc-nav-title">Introduction to Aether</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <a href="/documentation/try/index.html"><h3 class="doc-nav-title">Try It For Yourself</h3></a>
        <ul class="active-section">
          
            <li class="">
              <a href="/documentation/try/index.html">Installing Aether Bootstrap</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-core.html">Setting up an Aether-Based Solution</a>
            </li>
          
            <li class="active">
              <a href="/documentation/try/walkthrough-connect.html">Adding Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/walkthrough-gather.html">Adding Gather</a>
            </li>
          
        </ul>
    
      <a href="/documentation/setup-deployment/index.html"><h3 class="doc-nav-title">Setup and Deployment Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
        </ul>
    
      <a href="/documentation/ui/index.html"><h3 class="doc-nav-title">Aether UI User Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
  </div>
  <div class="doc-content">

    <h1 id="adding-aether-connect">Adding Aether Connect</h1>

<p>So far we have set up mappings so that we can be sure that our data conforms to predefined contracts. We used schemas to specify these contracts, and then saw how the data was transformed into entities based on those schemas.</p>

<p>We’re now going to find out how we can get this mapped data to be published in real time. This is done by <strong>Aether Connect</strong>, which is a system that uses Kafka plus pluggable “consumers” in order to stream entities out to various destinations. Right now we have a consumer for <a href="https://github.com/eHealthAfrica/aether-ckan-consumer">CKAN</a> and an <a href="https://github.com/eHealthAfrica/aether-consumer-sdk">SDK</a> to enable anyone to develop their own.</p>

<p>Bringing up Aether Connect is just a question of running <code class="highlighter-rouge">docker-compose up</code> on the relevant file:</p>

<p><code class="highlighter-rouge">docker-compose -f docker-compose-connect.yml</code></p>

<p>You can check that this worked by opening <a href="http://localhost:5005/status">http://localhost:5005/status</a> in your browser. You should see something like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    kafka: false,
    kernel: true,
    topics: { }
}
</code></pre></div></div>

<p>This is the status page for the Aether Producer, which sits between the Aether Kernel and Kafka, passing out entities as they are created. We can see that bith <code class="highlighter-rouge">kafka</code> and <code class="highlighter-rouge">kernel</code> are set to <code class="highlighter-rouge">true</code>. This means that the Aether Producer has successfully communicated with both of them.</p>

<p>We can also see that four topics have been created, <code class="highlighter-rouge">Surveys</code>, <code class="highlighter-rouge">Buildings</code>, <code class="highlighter-rouge">Households</code> and <code class="highlighter-rouge">People</code> (TODO - are these correct?). Kafka separates its data feeds into separate topics, and the Producer automatically creates a new topic for each schema in Kernel. The Producer has found the entities that were created when we submitted data using <code class="highlighter-rouge">curl</code>, and has passed them to Kafka.</p>

<p>So now that we have got some entities <em>into</em> Kafka, how do we get them out? That’s where we need a consumer. We’re going to use the CKAN consumer, so that we can watch our data get published to CKAN in real time. Starting the CKAN Consumer is pretty easy (clue: it rhymes with “flocker pompose”), but before we can do that we’ll need to take a short diversion so that we can get CKAN up and running.</p>

<h2 id="installing-ckan">Installing CKAN</h2>

<p>We’ve supplied a script in the Github repository for the CKAN Consumer that will make it easy to install CKAN locally, so let’s start by cloning that repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ..
git clone git@github.com:eHealthAfrica/aether-ckan-consumer.git
cd aether-ckan-consumer/example
scripts/setup_ckan.sh
</code></pre></div></div>

<p>This script will prompt you to create a user named <code class="highlighter-rouge">admin</code>, and ask you for a password. Don’t forget the password that you enter; you will need it shortly. At the end of the process the script will output registration information, including an API key. Copy this key.</p>

<p>Open <code class="highlighter-rouge">ckan-consumer/config/config.json</code> in your favourite editor, and change the value of <code class="highlighter-rouge">API_KEY</code> to what you just copied.</p>

<p>Now you can open CKAN in your browser - go to <a href="http://localhost:5000">http://localhost:5000</a>. Login using the password that you just entered. Select <em>Organization</em> from the top bar and create an organization with the name <code class="highlighter-rouge">eHADemo</code>.</p>

<h2 id="start-the-ckan-consumer-and-do-some-more-ckan-configuration">Start the CKAN Consumer and Do Some More CKAN Configuration</h2>

<p>To start the CKAN Consumer:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose -f ckan-consumer/docker-compose.yml up
</code></pre></div></div>

<p>The <code class="highlighter-rouge">docker-compose.yml</code> file mounts an example configuration that we’ve included in this example, so feel free to take a look at it in <code class="highlighter-rouge">ckan-consumer/config/config.json</code>. Note that we’re telling the consumer which Kafka topics we’re interested in, and that we reference the organization that we set up in CKAN a moment ago.</p>

<p>TODO create views in CKAN and</p>

<h2 id="submit-some-more-data">Submit Some More Data</h2>

<p>If you want to see how data is published to CKAN in real time, you can re-submit the data via curl:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ../aether-bootstrap
curl -H "Content-Type: application/json" --data @assets/submission.json http://admin-kernel:adminadmin@kernel.aether.local/submissions/
</code></pre></div></div>

<p>If you now reload the CKAN page in your browser, you should see the new entities displayed.</p>

<h2 id="recap">Recap</h2>

<ul>
  <li>we learned about Aether Connect, and how it consists of the Aether Producer, Kafka and Aether Consumers</li>
  <li>we started Aether Connect and saw the Producer’s status page</li>
  <li>we set up a local instance of CKAN</li>
  <li>we ran the Aether CKAN Consumer, learned a little about how it’s configured, and saw how it feeds data to CKAN</li>
</ul>

<p>In the next step, we’re going to learn about Gather, and we’ll add it to this project so that we can use ODK Collect to conduct the Microcensus.</p>


  </div>

</div>




    <div class="footer">
  <div class="social-links">
    <div class="email"><a href="mailto:solutions@ehealthafrica.org" target="_blank">solutions@ehealthafrica.org</a></div>
    <div class="facebook"><a href="https://www.facebook.com/EHealthAfrica" target="_blank"></a></div>
    <div class="twitter"><a href="https://twitter.com/eHealth_africa" target="_blank"></a></div>
    <div class="instagram"><a href="https://www.instagram.com/ehealthafrica/" target="_blank"></a></div>
    <div class="linkedin"><a href="https://www.linkedin.com/company/ehealth-&-information-systems-nigeria/" target="_blank"></a></div>
    <div class="youtube"><a href="https://www.youtube.com/channel/UCcgM_HhTcg5M9Ji3Of6QmUg" target="_blank"></a></div>
  </div>
  <a class="footer__logo" href="http://ehealthafrica.org" target="_blank">eHealth Africa</a>
</div>
      
    </div>
    <a href="#top" class="top circle-button-up"><i class="angle-right"></i></a>





        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-2.1.4.min.js"></script>
    <script src="/js/navbar.js"></script>
    <script src="/js/dropdown.js"></script>
    <script src="/js/input.js"></script>

  </body>

</html>
